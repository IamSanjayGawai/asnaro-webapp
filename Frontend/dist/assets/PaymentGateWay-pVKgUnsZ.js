import{m as _,r as s,d as ue,u as ge,n as he,a as q,B as L,ai as fe,j as e,S as U,al as O}from"./index-w2wx-x_X.js";import{R as ye}from"./index.esm-y_8cUbAG.js";import"./iconBase-7AsOp5YA.js";const be="/assets/Payment_Cards-JnFvzV7c.jpg",R="http://localhost:8000",we=async m=>{var i;try{return(await _.post(`${R}/payment/newpaymentcheck`,m)).data}catch(o){return(i=o==null?void 0:o.response)==null?void 0:i.data}},je=async(m,i,o)=>{var u;try{return(await _.post(`${R}/payment/bank-transfer`,{transactionId:m,amount:i,promisedPaymentDate:o})).data}catch(x){return(u=x==null?void 0:x.response)==null?void 0:u.data}},Xe=()=>{var Y,$;const[m,i]=s.useState(""),[o,u]=s.useState(""),[x,D]=s.useState(!1),[b,E]=s.useState(!1),w=ue(),k=ge(),{id:g}=he(),[Ne,I]=s.useState(!1),[z,P]=s.useState(!1),[y,V]=s.useState(""),[j,B]=s.useState({error:"",details:[{errCode:"",errInfo:""}]}),[G,N]=s.useState(""),[J,v]=s.useState(""),[W,H]=s.useState(!1),[h,K]=s.useState(new Date),{transaction:n,paymentModalShow:Q}=q(L),S=(Y=n==null?void 0:n.transaction)==null?void 0:Y.promisedPaymentDate,{loading:Z}=q(L),[f,ee]=s.useState(""),[p,c]=s.useState({cardNumber:"",cardholderName:"",expiryMonth:"",expiryYear:"",securityCode:"",paymentType:"card",transactionId:g,amount:""}),[te,F]=s.useState(""),C=($=n==null?void 0:n.transaction)==null?void 0:$.contractSignedDate,X=C?new Date(new Date(C).setDate(new Date(C).getDate()+7)).toISOString().split("T")[0]:null;s.useEffect(()=>{y&&(window.location.href=y)},[y]),s.useEffect(()=>{ae()},[]),s.useEffect(()=>{var a,t,r,l;((a=n==null?void 0:n.transaction)==null?void 0:a.transaction_status)===3&&k(`/transaction/${g}/payment-completed`),ee((l=(r=(t=n==null?void 0:n.transaction)==null?void 0:t.quotation)==null?void 0:r[0])==null?void 0:l.totalAmountIncludingTax)},[n]),s.useEffect(()=>{c(a=>({...a,amount:f}))},[f]);const ae=async()=>{await w(fe(g))},se=a=>{let t=a.target.value.replace(/[^\d]/g,"");t=t.slice(0,16),a.target.value=t;const{name:r,value:l}=a.target;c(me=>({...me,[r]:l}));let d=t.match(/.{1,4}/g),pe=d?d.join("-"):"";F(pe)},re=a=>{const{name:t,value:r}=a.target;c(l=>({...l,[t]:r}))},ne=new Date().toISOString().split("T")[0],le=a=>{let t=a.target.value.replace(/[^\d]/g,"");if(t=t.slice(0,2),parseInt(t,10)<=12){const{name:r}=a.target;let l=t==="00"?"":t;N(l),i(""),c(d=>({...d,[r]:l})),console.log(p,typeof p.expiryMonth)}else N(t),i("Invalid Month! もう一度確認してください。 "),t===""&&i("")},oe=a=>{let t=a.target.value.replace(/[^\d]/g,""),r=new Date().getFullYear().toString().length;if(t=t.slice(0,r),parseInt(t)>=new Date().getFullYear()){v(t);const{name:l}=a.target;u(""),c(d=>({...d,[l]:t}))}else v(t),u("Invalid Year! もう一度確認してください。 "),t===""&&u("")},ce=a=>{let t=a.target.value.slice(0,3);t=t.match(/^\d{0,3}$/)?t:"",a.target.value=t;const{name:r,value:l}=a.target;c(d=>({...d,[r]:l})),console.log(p)},ie=()=>{c({cardNumber:"",cardholderName:"",expiryMonth:"",expiryYear:"",securityCode:"",paymentType:"card",transactionId:g,amount:f}),F(""),N(""),v("")},xe=async a=>{var r;a.preventDefault(),P(!0),console.log("Payment details",p);const t=await we(p);console.log("ThreeDSResponse",t),P(!1),"success"in t?V((r=t==null?void 0:t.success)==null?void 0:r.redirectUrl):B(t),ie()},de=async a=>{a.preventDefault(),console.log("promisedPaymentDate",new Date(h));const t=await je(g,parseInt(f),h);console.log("Bank Transfer Response",t),t!=null&&t.success?H(!0):B(t==null?void 0:t.error)},T=()=>{D(!0),E(!1),c(a=>({...a,paymentType:"card"}))},M=()=>{E(!0),D(!1),c(a=>({...a,paymentType:"bank"}))},A=()=>{try{k(`/transaction/${g}`)}catch(a){console.error("Error redirecting transaction:",a)}};return console.log("amount",f),console.log("redirectUrl",y),console.log("transaction",n),console.log("transferDeadline",X),console.log("promisedPaymentDate",h),console.log("appErr",j),e.jsx("div",{className:"min-h-screen",children:Z?e.jsx(U,{}):Q&&e.jsx("div",{className:"lg:justify-center lg:items-center lg:flex lg:overflow-auto lg:fixed inset-0 lg:z-50 outline-none lg:focus:outline-none lg:bg-[#00000080]",children:W||S?e.jsx("div",{className:"lg:relative xs:w-full sm:w-5/6 md:w-3/5 lg:w-full xl:w-3/5 my-6 w-auto mx-auto lg:border ",children:e.jsxs("div",{className:"border-2 shadow-lg lg:relative flex gap-5 flex-col w-full bg-white p-4 outline-none focus:outline-none justify-center text-[#255BB3] items-center",children:["お支払いが開始されました。約束の支払い日までに、以下の銀行口座に金額を入金してください。支払いが確認されると、次のステップに進みます。これが期限です:",X," 約束された支払い日は次のとおりです:"," ",new Date(S||h).toISOString().split("T")[0],e.jsx("button",{className:"bg-[#808080] border-2 text-[#E6E6E6] text-xl leading-none font-semibold outline-none focus:outline-none p-2 mt-4 w-2/5",onClick:()=>{I(!1),w(O(!1)),A()},children:" 戻る"})]})}):e.jsx("div",{className:"lg:relative xs:w-full sm:w-5/6 md:w-3/5 lg:w-full xl:w-4/5 my-6 w-auto mx-auto lg:border",children:e.jsxs("div",{className:"border-0 shadow-lg lg:relative flex gap-4 flex-col w-full bg-white outline-none focus:outline-none",children:[e.jsx("div",{className:"flex items-start justify-between p-2 rounded-t mt-20",children:e.jsx("button",{className:"p-1 ml-auto bg-transparent border-0 text-black float-right text-3xl leading-none font-semibold outline-none focus:outline-none",onClick:()=>{I(!1),w(O(!1)),A()},children:e.jsx(ye,{})})}),e.jsx("div",{className:"text-sm flex lg:justify-center lg:items-center font-bold text-[#255BB3] lg:text-[24px] xs:text-[16px] xs:px-8 mt-8 w-full",children:e.jsx("span",{className:"",children:"お支払い方法の選択"})}),e.jsx("div",{className:"px-8 pb-[60px] flex flex-col justify-center items-center  w-full",children:e.jsx("div",{children:e.jsxs("div",{className:"flex lg:flex-row xs:flex-col gap-5 w-full justify-center  ",children:[e.jsxs("form",{onClick:T,onSubmit:xe,className:`flex justify-center flex-col py-5 lg:w-2/4 xs:w-full border ${x?"border-neutral-900":"border-[#E6E6E6]-500"} border-[#E6E6E6]-500`,children:[e.jsxs("div",{className:"flex lg:justify-center lg:items-center px-8 gap-5",children:[e.jsx("input",{type:"radio",className:"w-[21px] h-[21px]",id:"card",checked:x,onChange:T}),e.jsx("p",{className:"text-center font-bold text-[#255BB3] lg:text-[#255BB3] lg:text-[18px] xs:text-[16px]",children:"クレジットカード"})]}),e.jsx("div",{className:"flex lg:justify-center py-2 px-4 flex-col gap-5 lg:items-center",children:e.jsx("img",{src:be,alt:"Payment Cards",className:"lg:w-3/4 xs:w-2/4"})}),e.jsxs("div",{className:"flex flex-col gap-3 mt-3",children:[e.jsxs("div",{className:"px-8",children:[e.jsx("label",{className:"block lg:text-[18px] xs:text-[16px] font-medium mb-1 text-[#808080]",htmlFor:"card-nr",children:"クレジットカード番号"}),e.jsx("input",{id:"card-nr",name:"cardNumber",className:"lg:text-[18px] xs:text-[16px] text-gray-800 bg-white border rounded leading-5 py-2 px-3 border-gray-200 hover:border-gray-300 focus:border-indigo-300 shadow-sm placeholder-gray-400 focus:ring-0 w-full",type:"text",value:te,onChange:se,required:!0})]}),e.jsxs("div",{className:"px-8",children:[e.jsx("label",{className:"block lg:text-[18px] xs:text-[16px] font-medium mb-1 text-[#808080]",htmlFor:"card-name",children:"名義"}),e.jsx("input",{id:"card-name",name:"cardholderName",className:"lg:text-[18px] xs:text-[16px] text-gray-800 bg-white border rounded leading-5 h-10 py-2 px-3 border-gray-200 hover:border-gray-300 focus:border-indigo-300 shadow-sm placeholder-gray-400 focus:ring-0 w-full",type:"text",value:p.cardholderName,onChange:re,required:!0})]}),e.jsxs("div",{className:"px-8 flex justify-between items-center gap-4 w-full ",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block lg:text-[18px] xs:text-[16px] font-medium mb-1 text-[#808080]",htmlFor:"card-security-code",children:"有効期限月"}),e.jsx("input",{id:"card-expiry-month",name:"expiryMonth",className:"lg:text-[18px] xs:text-[16px] text-gray-800 bg-white border rounded leading-5 py-2 px-3 border-gray-200 hover:border-gray-300 focus:border-indigo-300 shadow-sm placeholder-gray-400 focus:ring-0 w-full",type:"text",value:G,onChange:le,required:!0}),m&&e.jsx("p",{className:"text-fifth",children:m})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block lg:text-[18px] xs:text-[16px] font-medium mb-1 text-[#808080]",htmlFor:"card-security-code",children:"有効期限"}),e.jsx("input",{id:"card-expiry-year",name:"expiryYear",className:"lg:text-[18px] xs:text-[16px] text-gray-800 bg-white border rounded leading-5 py-2 px-3 border-gray-200 hover:border-gray-300 focus:border-indigo-300 shadow-sm placeholder-gray-400 focus:ring-0 w-full",type:"number",value:J,onChange:oe,required:!0}),o&&e.jsx("p",{className:"text-fifth",children:o})]})]}),e.jsxs("div",{className:"px-8",children:[e.jsx("label",{className:"block lg:text-[18px] xs:text-[16px] font-medium mb-1 text-[#808080]",htmlFor:"card-name",children:"セキュリティコード"}),e.jsx("input",{name:"securityCode",className:"lg:text-[18px] xs:text-[16px] text-gray-800 bg-white border rounded leading-5 py-2 px-3 border-gray-200 hover:border-gray-300 focus:border-indigo-300 shadow-sm placeholder-gray-400 focus:ring-0 w-full",type:"password",value:p.securityCode,onChange:ce,required:!0})]})]}),x&&j.error&&e.jsx("div",{className:"px-8 text-red-700 flex justify-between items-center gap-4 w-full",children:"Something went wrong, Check your credentials"}),e.jsx("button",{type:"submit",className:"bg-[#FFAA00] text-white py-2 mt-8 mx-8 font-[700] text-[18px]",children:z?e.jsx(U,{className:"h-full w-full"}):"決済する"})]}),e.jsxs("form",{onClick:M,onSubmit:de,className:`flex justify-center flex-col lg:gap-6 py-5 lg:w-2/4 xs:w-full border ${b?"border-neutral-900":"border-[#E6E6E6]-500"}`,children:[e.jsxs("div",{className:"flex lg:justify-center lg:items-center px-8 gap-5",children:[e.jsx("input",{type:"radio",className:"w-[21px] h-[21px]",id:"bank",checked:b,onChange:M}),e.jsx("p",{className:"text-center font-bold text-[#255BB3] lg:text-[#255BB3] lg:text-[18px] xs:text-[16px]",children:"銀行振込"})]}),e.jsx("div",{className:"flex justify-center py-2 px-8 flex-col gap-5 mb-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[#808080] lg:text-[18px] xs:text-[16px]",children:"振込先"}),e.jsx("span",{className:"text-[#808080] lg:text-[18px] xs:text-[16px] mt-3",children:"銀行名（コード） XXXXX銀行（XXXX）"}),e.jsx("span",{className:"text-[#808080] lg:text-[18px] xs:text-[16px]",children:"支店名（コード） XXXXX支店（XXXX）"}),e.jsx("span",{className:"text-[#808080] lg:text-[18px] xs:text-[16px]",children:"区分 普通預金"}),e.jsx("span",{className:"text-[#808080] lg:text-[18px] xs:text-[16px]",children:"口座番号 XXXXXXXXXXXXXXXX"}),e.jsx("span",{className:"text-[#808080] lg:text-[18px] xs:text-[16px]",children:"口座名義 XXXXXXXXXX"}),e.jsxs("span",{className:"text-[#808080] lg:text-[18px] xs:text-[16px]",children:["振込期限 ",X]})]})}),e.jsxs("div",{className:"flex flex-col px-8 mt-10 gap-2",children:[e.jsx("label",{className:"text-[#808080] lg:text-[18px] xs:text-[16px]",children:"振込予定日 ※契約後7日以内"}),e.jsx("input",{type:"date",value:new Date(h).toISOString().split("T")[0],onChange:a=>K(new Date(a.target.value)),min:ne,className:"text-sm text-gray-800 bg-white border rounded leading-5 py-2 px-3 border-gray-200 hover:border-gray-300 focus:border-indigo-300 shadow-sm placeholder-gray-400 focus:ring-0 w-full"})]}),b&&j.error&&e.jsx("div",{className:"flex flex-col px-8 mt-10 gap-2",children:"Something went wrong"}),e.jsx("button",{type:"submit",className:"bg-[#FFAA00] text-white py-2 mt-8 mx-8 font-[700] text-[18px]",children:"決済する"})]})]})})})]})})})})};export{Xe as default};
