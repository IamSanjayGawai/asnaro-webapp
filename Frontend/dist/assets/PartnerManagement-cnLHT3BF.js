import{d as E,r,j as e,ax as $,a as V,ae as J,z as K,u as Z,az as G,S as D}from"./index-w2wx-x_X.js";import{K as H}from"./baseline-5AKzli58.js";import{R as Q}from"./index.esm-y_8cUbAG.js";import{u as W}from"./useTableTheme-44lDDVWp.js";import"./emotion-react.browser.esm-kI5PoqX3.js";import"./hoist-non-react-statics.cjs-j2Vrlo-h.js";import"./extends-_9I-EFOp.js";import"./assertThisInitialized-4q6YPdh3.js";import"./memoize-one.esm-oV5jpQgL.js";import"./setPrototypeOf-ahVgEFUp.js";import"./iconBase-7AsOp5YA.js";const X=({showPartnerModal:a,setShowModal:o,show:c=!0,idToApprove:x,partnerFlagStatus:l})=>{const d=E(),[u]=r.useState(!0);console.log("partnerFlagStatus",l);const h=async()=>{await d($(x)),await o(!1)};return e.jsx(e.Fragment,{children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`justify-center items-center flex overflow-x-hidden overflow-y-auto fixed inset-0 z-50 outline-none focus:outline-none\r
            \r
            `,children:e.jsx("div",{className:"relative w-auto my-6 mx-auto max-w-3xl",children:e.jsxs("div",{className:"border-0  shadow-lg relative flex gap-5 flex-col w-full bg-white outline-none focus:outline-none",children:[e.jsx("div",{className:"flex items-start justify-between p-4  rounded-t",children:e.jsx("button",{className:"p-1 ml-auto bg-transparent border-0 text-black float-right text-3xl leading-none font-semibold outline-none focus:outline-none",onClick:()=>o(!1),children:e.jsx(Q,{})})}),u?e.jsxs("div",{className:"relative px-4 gap-5 flex-auto ",children:[e.jsx("h3",{className:"mb-6 text-[#255BB3] text-center font-noto-sans-jp font-bold text-[20px]",children:"本気ですか？ ×"}),e.jsx("p",{className:"text-[#808080] text-sm font-noto-sans-jp px-8 text-base font-[500]  w-2/3 mt-[4em] mb-[3em] mx-auto",children:`このユーザーのパートナーとして  ${l?"取り除く":"申請する"}  ことに同意しますか? はいの場合は [適用] ボタンをクリックし、いいえの場合は [戻る] をクリックしますか?`})]}):e.jsxs("div",{className:"relative px-4 gap-5 flex-auto ",children:[e.jsx("h3",{className:"mb-6 text-[#255BB3] text-center font-noto-sans-jp font-bold text-[20px]",children:"本気ですか？ ×"}),e.jsx("p",{className:"text-[#808080] text-sm font-noto-sans-jp px-8 text-base font-[500]  w-2/3 mt-[4em] mb-[3em] mx-auto",children:`このユーザーのパートナーとして  ${l?"取り除く":"申請する"}  ことに同意しますか? はいの場合は [適用] ボタンをクリックし、いいえの場合は [戻る] をクリックしますか?`})]}),e.jsxs("div",{className:"grid grid-cols-1 justify-center p-4 w-2/3 mx-auto mb-8 ",children:[c&&e.jsx("button",{className:"bg-[#FFAA00] text-white  font-bold uppercase text-sm px-6 py-3 w-[348px]  outline-none  mx-auto mb-2",type:"submit",onClick:h,children:l?"取り除く":"申請する"}),e.jsx("button",{className:"bg-[#808080] text-white  font-bold uppercase text-sm px-6 py-3 w-[348px] mx-auto  outline-none mb-1",type:"button",onClick:()=>{o(!1)},children:"戻る"})]})]})})}),e.jsx("div",{className:"opacity-25 fixed inset-0 z-40 bg-black"})]}):null})},de=()=>{var C,S,k;const{allApprovedPartners:a,loading:o,partnerListLoading:c}=V(J),x=E(),[l,d]=r.useState(!1),[u,h]=r.useState(null),[y,I]=r.useState(),R=W("1fr 2fr 4fr 4fr 4fr 3fr",6),P=K(),j=new URLSearchParams(P.search).get("page"),[p,T]=r.useState(j?parseInt(j):1),L=Z(),w=10,f=Math.max(1,((C=a==null?void 0:a.pagination)==null?void 0:C.currentPage)-Math.floor(w/2)),g=Math.min((S=a==null?void 0:a.pagination)==null?void 0:S.totalPages,f+w-1),A=Array.from({length:g-f+1},(t,n)=>f+n),N=async t=>{T(t),L(`/admin/dashboard/partner-management?page=${t}`)},F=(t,n)=>{_(s=>({...s,nodes:s.nodes.map(i=>i.Enterprise_ID===t?{...i}:i)})),h(t),d(!0),I(n)};r.useEffect(()=>{x(G(p))},[p,x,c]);let q=[];r.useEffect(()=>{var t;if(Array.isArray(a==null?void 0:a.users)){const n=a&&((t=a==null?void 0:a.users)==null?void 0:t.map(s=>({admit:s==null?void 0:s.partner_flg,Enterprise_ID:(s==null?void 0:s._id)||"NA",Registered_Date:s!=null&&s.createdAt?new Date(s.createdAt).toISOString().split("T")[0]:"NA",Partner_Request_Date:s!=null&&s.partner_request_time?new Date(s.partner_request_time).toISOString().split("T")[0]:"No incoming request",Company_name:(s==null?void 0:s.name01)||"NA",partner_status:(s==null?void 0:s.partner_status)||"NA"})));_({nodes:n})}},[a]);const[v,_]=r.useState({nodes:q});console.log("data:",v);const B="http://localhost:8000",M=async()=>{var t,n;try{const s=((t=a==null?void 0:a.csvPartners)==null?void 0:t.length)>0?a.csvPartners.map(b=>b._id):(n=a==null?void 0:a.csvPartners)==null?void 0:n.map(b=>b._id);if(console.log("allApprovedPartners partnerIds:",s),!s){console.error("No partner IDs available for download.");return}const i=await fetch(`${B}/admin/download/csv`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({partner_Ids:s,formType:"partner-list"})});if(!i.ok)throw new Error("Network response was not ok.");const U=await i.blob(),z=window.URL.createObjectURL(U),m=document.createElement("a");m.href=z,m.setAttribute("download","partner-list.csv"),document.body.appendChild(m),m.click()}catch(s){console.error("Error downloading CSV:",s)}},O=[{label:"承認",key:"admit",renderCell:t=>e.jsx("div",{className:"flex items-center ",children:e.jsx("input",{type:"checkbox",checked:t.admit,onChange:()=>F(t.Enterprise_ID,"admit")})})},{label:"パートナー状態",key:"partner_status",renderCell:t=>e.jsx("div",{className:"text-[#808080] text-[12px] font-[400]  line-clamp-3 text-center ",style:{whiteSpace:"normal"},children:t.partner_status})},{label:"企業ID",key:"Enterprise_ID",renderCell:t=>e.jsx("div",{className:"text-[#808080] text-[12px] font-[400]  line-clamp-3 text-center ",style:{whiteSpace:"normal"},children:t.Enterprise_ID})},{label:"登録日時",key:"Registerd_Date",renderCell:t=>e.jsx("div",{className:"text-[#808080] text-[12px] font-[400] line-clamp-1 text-center ",style:{whiteSpace:"normal"},children:t.Registered_Date})},{label:"Partner Request Date",key:"Partner_Request_Date",renderCell:t=>e.jsx("div",{className:"text-[#808080] text-[12px] font-[400] line-clamp-1 text-center ",style:{whiteSpace:"normal"},children:t.Partner_Request_Date})},{label:"企業名",key:"Company name",renderCell:t=>e.jsx("div",{className:"text-[#808080] text-[12px] font-[400] line-clamp-1 text-center ",style:{whiteSpace:"normal"},children:t.Company_name})}];return e.jsxs(e.Fragment,{children:[o?e.jsx(D,{}):e.jsxs("div",{className:"mb-40",children:[e.jsx("div",{className:"lg:mx-20 md:mx-8 xs:mx-8 flex  flex-col xs:mt-[24px] md:mt-[50px]",children:e.jsx("h1",{className:"text-[#808080] font-[700] text-[24px] mb-4",children:"パートナー管理"})}),e.jsxs("div",{className:"lg:mx-20 md:mx-8 xs:mx-8 mt-[3rem]  lg:min-w-[900px] ",children:[e.jsx("div",{className:"flex items-center justify-between sm:block ",children:e.jsx("div",{className:"flex justify-end gap-2 text-center",children:e.jsx("button",{onClick:()=>{M()},className:"text-white bg-[#FFAA00] px-5 py-1 ",children:"CSV出力"})})}),e.jsx("div",{className:"mt-4 border-[1px] border-[#E6E6E6] overflow-x-auto",children:c?e.jsx(D,{className:"w-full h-full"}):e.jsx(H,{data:v,columns:O,theme:R,layout:{custom:!0,horizontalScroll:!0}})}),e.jsxs("div",{className:"col-span-12 bg-[#F5F5F5] h-[60px] flex justify-center items-center gap-2 mt-[50px]",children:[e.jsx("div",{className:"flex gap-1",children:A.map((t,n)=>e.jsx("button",{className:`border w-[25px] ${p===t?"bg-primary text-white":"bg-white"} border-[#DCDCDC]`,onClick:()=>N(t),children:t},n))}),g<((k=a==null?void 0:a.pagination)==null?void 0:k.totalPages)&&e.jsxs("div",{className:"flex gap-1 items-center cursor-pointer",onClick:()=>N(g+1),children:[e.jsx("div",{className:"font-[500] text-primary text-[16px] w-full",children:"次ページ"}),e.jsx("svg",{className:"",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"18",viewBox:"0 0 16 18",fill:"none",children:e.jsx("path",{d:"M15.4318 9L0.138137 17.6603L0.138138 0.339745L15.4318 9Z",fill:"#255BB3"})})]})]})]})]}),l?e.jsx(X,{showPartnerModal:l,setShowModal:d,idToApprove:u,partnerFlagStatus:y}):""]})};export{de as default};
